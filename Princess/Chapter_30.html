<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Chapter 30 - Princess</title>
	<link rel="stylesheet" type="text/css" href="../libs/style.css">
	<script src="../libs/run_prettify.js?autoload=true&amp;lang=css" defer=""></script>
	<script type="text/javascript" src="../libs/three.js"></script>
	<script type = "text/javascript" src = "../libs/dat.gui.js"></script>
	<script src = "../libs/OrbitControls.js"></script>
	<script src = "../libs/WebGeometry.js"></script>
	<script src = "../libs/polyhedron.js"></script>
	<script src = "princess_verts.js"></script>
	<script src = "princess.js"></script>
	
	<style>
		#div_out_big
		{
			position: relative;
			width: 1075px;
			height: 525px;
			left: 0px;
			background-color: #aaffff;
			border: solid 2px;
		}
		#div_in_big
		{
			position: absolute;
			left: 5px;
			top: 5px;			
			height: 410px;
			width: 1145px;
			background-color: #eeffee;
			border: solid 2px;
		}
		#div_pars_big
		{
			position: absolute;
			left: 530px;
			top: 2px;			
			height: 515px;
			width: 280px;
			background-color: #eeeeaa;
			border: solid 2px;
		}
		#gui_container_big
		{
			position: absolute;
			left: 820px;
			top: 5px;
		}
	</style>
</head>

<body>

<h3 align = "center">&emsp;&emsp;
<a href="../Trilliant/Chapter_29.html"> <span class=brown>Глава 29 </span></a>  <span class=brown>&ensp;◄</span>
&emsp;&emsp;&emsp;
<a href="../index.html"> <span class=brown> Содержание  </span></a>
&emsp;&emsp;&emsp;
 <span class=brown>► &ensp;</span><a href="../Pyramid/Summary.html"> <span class=brown> Заключение  </span></a>
</h3>

<h2 align = "center"> Three.js и геометрия. &ensp; Глава 30. &ensp;Принцесса с тремя шевронами на подушке (<em>Princess3s on the cushion</em>)</h2>


<p>В данном разделе мы создадим модель огранки, которую назовем <em>принцессой с тремя шевронами на подушке</em>.
Кто такая принцесса с шевронами и почему она на подушке? Одним из распространенных типов огранок является принцесса.
Эта форма огранки была разработана в 1960-е годы, а примерно в 1980-81 гг. получила название <em>Принцесса</em>. 
Эта новая форма в мире бриллиантов выглядит современно. Считается, что она была названа <em>Принцесса</em> потому, 
что такой камень сегодня достоин украшать представителей королевских фамилий. 
Огранки принцесса строятся на основе рундиста имеющего форму квадрата или прямоугольника. Внешний вид трех огранок принцесса, 
различающихся формой павильона, показан на рисунке <b>1</b>.
</p>
<img src = "png_01.png" class="center-img">
<p>
Как можно увидеть из <em>online</em>-программы павильон имеет четыре основных грани расположенные по диагоналям огранки. 
Они начинаются у угловых вершин рундиста и сходятся в калетте огранки. 
На павильоне огранки – вдоль каждой из четырех сторон рундиста – расположен ярус из четырех граней. 
Между этими гранями и основными угловыми гранями павильона (они простираются от рундиста до калетты) 
расположены еще три яруса граней, называемых шевронами (<em>chevron</em>). В верхней части рис.<b>1</b> показана огранка 
принцесса с двумя ярусами таких граней – принцесса с двумя шевронами – <em>Princess2s</em>. 
В средней части рисунка показана огранка принцесса с тремя ярусами шевронов - <em>Princess3s</em>, 
а в нижней части – огранка с четырьмя ярусами шевронов – 
<b><a href="http://diamond3d.ucoz.ru/Princess4s/Princess4s_wireframe_trackball.html" target="_blank">Princess4s</a></b>.
Короны на всех трех показанных на рисунке 1 огранок имеет один и тот же прямоугольный вид. 
В <em>online</em>-программе корона построена как у огранок типа <em>cushion</em>.
</p>
<p>
Обычно огранки типа принцесса строятся на основе квадратного или прямоугольного рундиста. 
Огранки принцесса, которые показаны на рисунке <b>1</b> можно назвать классическими огранками этого типа. 
Однако можно использовать для этих огранок  форму рундиста отличную от прямоугольной. 
Наилучшим образом для этой цели подходит рундист от огранок подушка, 
чью форму можно менять от весьма округлой до почти прямоугольной. В данной главе будет рассмотрено создание
огранки типа принцесса с тремя шевронами и с рундистом подушка. Будем называть эту огранку как <em>Princess3s_on_Cushion</em>
или иногда для сокращения просто 
<b><a href="http://diamond3d.ucoz.ru/Princ3sCush/Princ3sCush_wireframe_trackball.html" target="_blank">Princess</a></b>.
</p>
<p>
По ссылке  <b><a href="http://diamond3d.ucoz.ru/Dispersion/Princess3s_on_Cushion_D.html" target="_blank">Princess3s_on_Cushion Cube Map</a></b>  
можно увидеть эту огранку отображенную при помощи кубических карт. Нажав на приведенной по ссылке 
странице кнопку <b>Inverse</b> можно увидеть огранку на черном фоне.
</p>

<br>
<div id="div_out_big"> 
		<canvas id="canvas" width="522" height="522" style="border: 1px solid"></canvas>
		<div id="div_pars_big" >
			<canvas id="canvas_pars" width="280" height="480"></canvas>
			<div id="div_input">
				                     <input type="radio" name="numeration" id = "btn_no"  />No
				&nbsp&nbsp&nbsp&nbsp <input type="radio" name="numeration" id = "btn_all" />All
				&nbsp&nbsp&nbsp&nbsp <input type="radio" name="numeration" id = "btn_cr_gd_pav"  />Cr-Gd-Pav
			</div>		
		</div>
		<div id="gui_container_big" ></div> 
</div>
<h3 align = "center"> Нумерация вершин и обозначение граней модели </h3>
<p>

</p>
<img src = "png_02.png" class="center-img">

<h3 align = "center"> Структура данных модели (СДМ) огранки  </h3>
&nbsp; &nbsp; Структура данных модели содержит следующие параметры:
<pre class="prettyprint" id="quine">
var lw = 1.0;      // Отношение длины огранки к ширине
// Рундист
var r = 0.05;     // Толщина рундиста
var del_gd = 0.02;
var rounnd_cir1 = 0.054;         // "Roundness front"
var rounnd_cir2 = 0.054;         // "Roundness flank"
var R3 = 0.11;                   // "Radius corner"
var crown_ang_gd = 35.0*DEGREE;  // то же что и ang_2 и ang_3
var pav_ang_gd = 63.0*DEGREE;    // то же что и ang_2 и ang_3
var ang_corner = 45.0*DEGREE;    // "Corner angle girdle"
var gd_segments = 0.29;          // // Основной параметр задающий размеры сегментов

// Корона
var beta = 32*DEGREE;            // Угол короны
var t = 0.60;                    // Размер площадки
var starFacets = 0.5;            // Задает положение средних вершин короны

// Павильон
var hp = 0.57;
var pavilionAngle = 56*DEGREE; // Задает угол наклона граней павильона примыкающей к рундисту
                               //   Более точное определение - угол наклона ребра  
                               // соединяющего вершину 64 рундиста с вершиной 0 павильона
var virtCuletOffsetX = 0.00001*DEGREE;  // Смещение виртуальной калетты по оси OX
var virtCuletOffsetY = 0.00001*DEGREE;  // Смещение виртуальной калетты по оси OY
var pavilionFirstLevel = 0.65;  // Отношение размера  большой грани 
                                //    к максимально-возможному ( >= 0, <= 1 )
var pavilionLastLevel = 0.35;   // Отношение размера основной грани 
                                //    к максимально-возможному ( >= 0, <= 1 )
var kf_bulge_s2 = 0.5           // Задает выпуклость грани S2 с выпуклой стороны
var kf_bulge_s3 = 0.1;          // Задает выпуклость грани S3 с выпуклой стороны
var kf_flat_s2 = 0.50;          // Задает выпуклость грани S2 с плоской стороны
var kf_flat_s3 = 0.01;          // Задает выпуклость грани S2 с плоской стороны
</pre>

<h3 align = "center"> Расчет положения вершин рундиста  </h3>
<p>
Для огранок принцесса построенных на основе рундиста подушка можно было бы для короны и павильона выбрать такую же форму, 
что используется в прямоугольных огранках этого типа изображенных на рисунке <b>1</b>. 
Однако, так как рундист подушки всегда обладает в большей или меньшей мере округленностью, 
то для того, чтобы сделать рундист достаточно равномерным по толщине, 
предпочтительно разбить большие грани короны и павильона примыкающие к рундисту  
на несколько более мелких граней. Более того, для короны можно выбрать такой же вид (и построение) как у огранки <em>Maltese</em>.
Такой внешний вид короны, по моему мнению, выглядит лучше, чем вид короны огранок показанных на рисунке <b>1</b>
(по крайней мере применительно к рундисту типа подушка).
<br>
&emsp;Особенностью  огранки <em>Princess3s_on_Cushion</em>, как хорошо видно из рисунка <b>4</b>, является то, что узловые вершины рундиста 
(те вершины, к которым подходят ребра короны и павильона) со стороны короны и павильона не полностью совпадают. 
Это дает возможность делать форму огранки более варьируемой. 
Разбиение рундиста на сегменты со стороны короны и со стороны павильона осуществляется независимо друг от друга.
Такое <em>разбиение</em> рундиста на сегменты похоже на то как оно осуществлялось в огранке <em>Octagram</em>. 
Но в обоих случаях <em>размеры сегментов</em> как для короны так и для павильона определяются по способу, 
примененному в огранке <em>Maltese</em>.
</p>

<img src = "png_03.png" class="center-img">
<p>
Если предположить, что огранка будет в основном использоваться при небольших удлинениях (параметр <b>lw</b> равен или близок к <b>1.0</b>), 
то размер сегментов рундиста (рис.<b>4</b>) передней части (вершины <b>0-4</b> и <b>4-8</b>) 
и боковой части (вершины <b>8-12</b> и <b>12-16</b>) рундиста со стороны короны можно регулируровать одновременно 
одним и тем же параметром <b>crown_ang_gd</b>. То же самое относится к передним (вершины <b>64-66</b> и <b>66-72</b>) 
и боковым (вершины <b>72-78</b> и <b>78-80</b>) сегментам рундиста со стороны павильона, размеры которых изменяются 
одновременно параметром <b>pav_ang_gd</b> (рис.<b>4</b>). Каждый из этих двух параметров заменяет собой 
пару параметров <b>ang_2</b> и <b>ang_3</b>, 
которые использовались при построении рундиста <em>Maltese</em>. 
<br>
&emsp;На тот случай, что если все же предполагается в некоторых пределах изменять 
величину удлинения огранки, вводится параметр <b>ang_corner</b>, который позволяет изменять (рис. <b>4</b>) 
положение вершины рундиста <b>8</b> (и <b>72</b>)  
для возможности исправления формы угловой грани <b>B</b> короны, которая теряет свою осевую симметрию 
при значении парметра <b>lw</b> отличном от <b>1.0</b>.
</p>

<h3 align = "center"> Расчет положения вершин короны  </h3>
<p>
Расчет положения вершин короны происходит также как и в огранке <em>Maltese</em>.
Для сокращения программы не введены вычисляемые параметры задающие высоту короны <b>hCrown</b> и <b>hCrown2</b>.
</p>

<h3 align = "center"> Расчет положения вершин павильона  </h3>
<p>
Как можно увидеть из <em>online</em>-программы павильон огранки имеет четыре основных грани расположенные по диагоналям огранки. 
Они начинаются у угловых вершин рундиста и сходятся в калетте огранки. На павильоне огранки – вдоль каждой из 
четырех сторон рундиста – расположен ярус из четырех граней. Между этими гранями и основными угловыми гранями павильона 
(они простираются от рундиста до калетты) расположены еще три яруса граней, называемых <em>шевронами</em> 
(<em>chevron</em>). 
</p>

<img src = "png_04.png" class = "left-img1">

<p>
При запуске  <em>online</em>-программы принцесса имеет симметричную форму павильона относительно 
взаимно перпендикулярных вертикальных плоскостей проходящих через центр огранки. 
В некоторых случах для сохранения массы заготовок, из которых создается огранка, приходится отказаться от полной симметрии павильона. 
Отдельные модели огранок, которые мы создали в предыдущих главах, предусматривали возможность изменения 
положения калетты в горизонтальной плоскости. Такое смещение калетты дает возможность в некоторой степени 
согласовать форму павильона с формой заготовки для огранки. При отклонении калетты от центральной 
оси симетрии огранки грани павильона, имевшие одинаковый наклон к горизонтальной плоскости, 
теряют это свойство и павильон становится несимметричным. Заметим, что огранка может потерять часть своей стоимости, 
по причине того, что если не находится в центре павильона (не лежит на оси симметрии огранки). 
</p>
<p>
Поэтому иногда, для того, чтобы существенно не уменьшать массу заготовки для огранки, используется еще один способ 
ее построения – положение калетты остается неизменным, но соответствующим образом изменяются углы наклона 
всех (или только некотрых) граней павильона. На рисунке <b>5</b> для создания несимметрии у павльона смещена вправо не сама калетта, 
а точка, которую можно рассматривать как виртуальную калетту огранки. Обычно величину этого смещения задают 
в угловых единицах измерения относительно углов наклона граней павильона расположенных вдоль сторон рундиста 
при отсутствии смещения. Само смещение обычно называют <em>виртуальным смещением калетты</em>. 
</p>
На рис.6 показан прямоугольник <b>OACB</b> в который вписана 1/4 часть проекции рундиста на горизонтальную плоскость <b>OXY</b>. 
Одновременно на рис.<b>6</b> в его правой верхней части показано положение характерных точек используемых для построения 
шевронов павильона расположенных вдоль оси <b>OX</b> огранки. В левой нижней части рис.<b>6</b> показано положение характерных точек 
используемых для построения шевронов павильона расположенных вдоль оси <b>OY</b> огранки. 
<br>
Для получения размеров необходимых для построения павильона в самом общем виде величина удлинения 
огранки <b>lw</b> на рис.<b>6</b> принята примерно равной <b>1.4</b>. На чертеже это отношение длины стороны <b>OA</b> 
прямоугольника к стороне <b>OB</b>. Определение характерных размеров павильона, необходимых для его построения происходит следующим образом.
</p>
<img src = "png_05.png" class="center-img">
<p>
Сначала проводится диагональ <b>ОС</b> прямоугольника, а затем строится отрезок <b>DG</b> перпендикулярный к этой диагонали и ограниченный 
точками пересечения прямой, на которой он лежит, с осями <b>OX</b> и <b>OY</b>. 
<br>
Затем проведем через точки <b>D</b> и <b>G</b> прямые составляющие 
угол <b>α</b> с осями <b>OX</b> и <b>OY</b>. Угол <b>α</b> - это угол, который составляют грани павильона <b>a, b, c</b> 
и <b>d</b> лежащие вдоль сторон рундиста с горизонтальной плоскостью <b>OXY</b>. Для задания этого угла в <b>СДМ</b> 
предусмотрено поле <code>pavilionAngle</code>, значение которого можно изменять при помощи соответствующего параметра. 
Заметим, что павильон строится таким образом, что при изменении удлинения огранки этот угол не изменяется, 
что и отражено на рис.<b>6</b>. Прямые, проведенные через точки <b>D</b> и <b>G</b> под углом <b>α</b> к осям <b>OX</b> и <b>OY</b>, 
пересекаются с этими осями в точках <b>F</b> и <b>F′</b> соответственно. 
На рис.6 показаны значения длин отрезков <b>OF</b> и <b>OF′</b>.  Эти значения требуются для расчета значений <b>w0 – w5</b>, 
исползуемых при построении павильона огранок принцесса (рис.<b>7</b>). 
</p>
<p>
При конструировании павильона сначала находится уравнение плоскости <b>pav</b>, в которой лежит одной из четырех 
граней примыкающих к калетте. Ее азимут определяется удлинением огранки <b>lw</b>. Затем поочередно для каждого 
из четырех направлений осей <b>OX</b> и <b>OY</b> производится расчет положения вершин павильона лежащих  на каждом из направлений. 
Для огранки с тремя шевронами (рис.<b>7</b>) это вершины <b>S0, S1, S2, S3</b> и <b>S4</b>. 
</p>
<p>
Рассмотрим, как происходит расчет этих вершин для огранки с тремя шевронами. Координаты точки <b>w0</b> по осям <b>OX</b> и <b>OY</b> равны <b>0</b>. 
Координаты точки <b>w5</b> равны <b>0.5</b>, если расчет идет вдоль оси <b>OY</b> и <b>lw • 0.5</b>, если расчет идет вдоль оси <b>OX</b>. 
Затем определяется значение величины <b>wd</b>. В зависимости от направления оно равно либо длине отрезка <b>OD</b> - при направлении вдоль <b>OX</b>, 
либо длине отрезка <b>OG</b> - при направлении вдоль <b>OY</b> (рис.<b>6</b>). Для нахождения значения длины отрезка <b>OG</b> рассмотрим два прямоугольных
треугольника <b>OAC</b> и <b>OCG</b>. Для указанных треугольников можно записать следующее выражение
<br>
&emsp;&emsp; <em><b>OB / OC = OC / OG</b></em> или <em><b>OG = OC • OC / OB</b></em>
<br>
После подстановки в последнее выражение значений для <b>OC</b> и <b>OB</b> получим, что значение <b>OG</b> равно
<br>
&emsp;&emsp; <em><b>OG = 0.5 + 0.5 • lw • lw</b></em>
Из рассмотрения подобных треугольников <b>OAC</b> и <b>ODC</b> найдем длину <b>OD</b>
<br>
&emsp;&emsp; <em><b>OD = 0.5/lw + 0.5 • lw</b></em>
<br>
Исходя из значения <b>wd</b> рассчитывется величины <b>wm</b>, 
а затем <b>w5, w1 , w2,  w3, w4</b> и <b>z4</b> (глубина точки <b>w4</b>). На рисунке <b>8</b> приведены формулы по которым
производятся соответствующие вычисления.
</p>
Как можно увидеть из приведенных на рис.<b>8</b> формул значение поля <b>СДМ</b> <code>pavilionFirstLevel</code> задает неявно 
положение точки <b>w5</b>, а, следовательно, косвенным образом и размер ломаной части павильона <b>S0-S1-S2-S3-S4-S5</b>. 
Значение поля СДМ <code>pavilionLastLevel</code> неявно задает ширину четырехугольных граней павильона примыкающих к калетте огранки. 
Глубину, на которой находится калетта, задает значение параметра <b>hp</b>, для которого также предусмотрено поле в <b>СДМ</b>.
<p>
Координата z точки S1 лежащей в случае, когда она принадлежит плоскости OXZ, проводится вертикальная прямая через 
точку с координатами (w1, 0, 0) и находится точка пересечения этой прямой с ранее найденной плоскостью pav. В том случае, 
если точка S1 принадлежит плоскости OYZ, проводится вертикальная прямая через точку с координатами (0, w1, 0) 
и находится точка пересечения этой прямой с той же плоскостью pav.
</p>
<p>
Предположим, что мы находим положение вершин павильона <b>13</b>, <b>9</b> и <b>5</b>, лежащих в плоскости <b>OXZ</b> 
в направлении возрастания значения координаты <b>x</b>. Этим вершинам на рис.<b>7</b> соответствуют точки <b>S2, S3</b> и <b>S4</b>. 
Проведем одну прямую через уже найденные точки <b>S0</b> и <b>S1</b>, а другую – через <b>S1</b> и <b>S4</b>. 
Найдем две точки пересечения, обозначенные на рис.<b>7</b> как <b>0</b> и <b>1</b>, с вертикальной прямой проходящей через точку <b>w2</b>. 
Положение точки <b>S2</b> можно выбрать в любом месте отрезка ограниченного точками <b>0</b> и <b>1</b>. 
Можно для нее выбрать, например, середину этого отрезка. Также, при желании более точно установить положение точки <b>S2</b> 
в <b>СДМ</b> огранки можно ввести параметр задающий коэффициент деления отрезка <b>0-1</b> на две равные или неравные части.
Положение точки <b>S3</b> определяется точно так же как и положение точки <b>S2</b>. Через точки <b>S1</b> и <b>S2</b> проводится одна прямая, 
а через точки <b>S2</b> и <b>S4</b> - другая. Затем проводится вертикальная прямая через точку <b>w3</b> и нахдятся точки 
пересечения этой прямой с прямыми <b>S1-S2</b> и <b>S2-S4</b>. Обозначим эти точки пересечения как <b>2</b> и <b>3</b>. 
Положение точки <b>S3</b>, совпадающее с положением вершины огранки <b>9</b>, можно выбрать внутри отрезка <b>2-3</b> точно 
таким же образом, как было выбрано положение точки <b>S2</b>.
</p>
<p>
Для регулировки положение точек <b>S2</b> и <b>S3</b> в <b>СДМ</b> введены две пары полей (<b>kf_bulge_s2, kf_flat_s2</b>) 
и (<b>kf_bulge_s3, kf_flat_s3</b>).
Введение этой возможности становится особенно актуальной, когда значение параметров, 
задающих смещение виртуальной калетты <b>virtCultOffsetX</b> и <b>virtCultOffsetY</b>, отлично от <b>0</b>. 
В этом случае одна или две стороны павильона огранки могут фактически превратиться в плоскость, 
а две другие стороны могут сильно отличаться от той формы, которая получается, особенно, когда выбор точки <b>S2</b> 
жестко определен при помощи константы заданной внутри программы.
</p>
<p>
Очевидно, что для огранки <em>Princess3s</em> число вершин, для которых можно ввести параметры регулировки их глубины равно <b>8</b>. 
Можно ограничиться половинным набором этих параметров. При таком подходе регулировка глубины вершин лежащих на одном 
ярусе павильона будет меняться одновременно одним параметром, если для сторон павильона на котором расположены эти 
вершины значение смещения виртуальной калетты имеет один знак. 
Например один параметр будет изменять высоту вершин на тех сторонах павильона, для которых значение параметра 
задающего смещение калетты отрицательно, а другой – для которых смещение калетты положительно. 
В первом случае сторона павильона становится более плоской (<em><b>flat</b></em>), а во втором – более выпуклой (<em><b>bulge</b></em>). 
В программе создания огранки <em>Princess3s</em> продемонстрирован именно такой подход к построению павильона. 
</p>
<pre class="prettyprint" id="quine">
	// Конструируем павильон
    var z0 = - r/2 - hp;
	var vec_lw = new Vector3D(-lw, 1.0, 0);
	vec_lw.Normer();
	var pav = new Plane3D();
	pav.CreatePlaneVectorTwoPoints(vec_lw, girdle[8+64], new Point3D(0, 0, - r/2 - hp));

	for ( i = 0; i < 4; i++ )
    {
        var wd, w5, tg_alpha;
        if (i == 0)
		{
			// Ось X > 0
			wd = lw/2 + 0.5/lw;
            w5 = lw * 0.5;
            tg_alpha = Math.tan(pavilionAngle + virtCuletOffsetX);
		}
        else if (i == 1)
		{
			// Ось Y > 0
            w5 = 0.5;
			wd = 0.5 + 0.5 * lw * lw;
            tg_alpha = Math.tan(pavilionAngle + virtCuletOffsetY );
		}
		else if (i == 2)
		{
			// Ось X < 0
			wd = lw/2 + 0.5/lw;
            w5 = lw * 0.5;
            tg_alpha = Math.tan(pavilionAngle - virtCuletOffsetX );
		}
		else 
		{
			// Ось Y < 0
            w5 = 0.5;
			wd = 0.5 + 0.5 * lw * lw;
            tg_alpha = Math.tan(pavilionAngle - virtCuletOffsetY );
        }
	
        var wm = wd * ( w5 * tg_alpha - hp ) / ( wd * tg_alpha - hp );
        var w4 = w5 + ( wm - w5 ) * pavilionFirstLevel;
        var z4 = - r/2 - ( w5 - w4 ) * tg_alpha;
        var w1 = wm * pavilionLastLevel; 

		var line_vert_1 = new Line3D(new Point3D(w1, 0, 0), new Point3D(w1, 0, 1));
		var line_vert_2 = new Line3D(new Point3D(0, w1, 0), new Point3D(0, w1, 1));

		var z1, kf_s2, kf_s3;

		if (i == 0)
		{
			// Ось X > 0
			var pt = line_vert_1.IntersectionLinePlane(pav);
			z1 = pt[2];

			if (virtCuletOffsetX >= 0)
			{
				kf_s2 = kf_bulge_s2;
				kf_s3 = kf_bulge_s3;
			}
			else
			{
				kf_s2 = kf_flat_s2;
				kf_s3 = kf_flat_s3;
			}
		}
		else if (i == 1)
		{
			// Ось Y > 0
			var pt = line_vert_2.IntersectionLinePlane(pav);
			z1 = pt[2];

			if (virtCuletOffsetY >= 0)
			{
				kf_s2 = kf_bulge_s2;
				kf_s3 = kf_bulge_s3;
			}
			else
			{
				kf_s2 = kf_flat_s2;
				kf_s3 = kf_flat_s3;
			}
		}
		else if (i == 2)
		{
			// Ось X < 0
			var pt = line_vert_1.IntersectionLinePlane(pav);
			z1 = pt[2];

			if (virtCuletOffsetX <= 0)
			{
				kf_s2 = kf_bulge_s2;
				kf_s3 = kf_bulge_s3;
			}
			else
			{
				kf_s2 = kf_flat_s2;
				kf_s3 = kf_flat_s3;
			}
		}
		else
		{
			// Ось Y < 0
			var pt = line_vert_2.IntersectionLinePlane(pav);
			z1 = pt[2];

			if (virtCuletOffsetY <= 0)
			{
				kf_s2 = kf_bulge_s2;
				kf_s3 = kf_bulge_s3;
			}
			else
			{
				kf_s2 = kf_flat_s2;
				kf_s3 = kf_flat_s3;
			}
        }

		var s0 = new Point2D(0.0, -z0);
		var s1 = new Point2D(w1, -z1);
		var s4 = new Point2D(w4, -z4);
		var s5 = new Point2D(w5, -r/2);

		var line0 = new Line2D(s0, s1);
		var s1_s4 = new Line2D(s1, s4);

		var del_x = (w4 - w1)/3.0;
		var w3 = w4 - del_x;
		var w2 = w4 - del_x - del_x;

		var ln_w2 = new Line2D(new Point2D(w2,0), new Point2D(w2,1));
		var ln_w3 = new Line2D(new Point2D(w3,0), new Point2D(w3,1));

		var point_1 = ln_w2.IntersectionTwoLines(line0);
		var point_0 = ln_w2.IntersectionTwoLines(s1_s4);

		// s2
		var s2 = new Point2D(w2, point_0[1] - kf_s2 * ( point_0[1] - point_1[1]));

		var line1 = new Line2D(s1, s2);
		var s2_s4 = new Line2D(s2, s4);
		var point_3 = ln_w3.IntersectionTwoLines(line1);
		var point_2 = ln_w3.IntersectionTwoLines(s2_s4);
		var s3 = new Point2D(w3, point_2[1] - kf_s3 * ( point_2[1] - point_3[1]));

        if (i == 0)
		{
			// Ось X > 0
			pavil[1] = new Point3D();
            pavil[1][0] = w4;
			pavil[1][1] = 0.0;
			pavil[1][2] = z4;

			pavil[5] = new Point3D();
			pavil[5][0] = w3;
			pavil[5][1] = 0;
			pavil[5][2] = -s3[1];

			pavil[9] = new Point3D();
			pavil[9][0] = w2;
			pavil[9][1] = 0;
			pavil[9][2] = -s2[1];

			pavil[13] = new Point3D();
			pavil[13][0] = w1;
			pavil[13][1] = 0.0;
			pavil[13][2] = z1;
		}
		else if (i == 1)
		{
			// Ось Y > 0
			pavil[0] = new Point3D();
            pavil[0][0] = 0.0;
			pavil[0][1] = w4;
			pavil[0][2] = z4;
			
			pavil[4] = new Point3D();
			pavil[4][0] = 0;
			pavil[4][1] = w3;
			pavil[4][2] = -s3[1];

			pavil[8] = new Point3D();
			pavil[8][0] = 0;
			pavil[8][1] = w2;
			pavil[8][2] = -s2[1];

			pavil[12] = new Point3D();
            pavil[12][0] = 0.0;
			pavil[12][1] = w1;
			pavil[12][2] = z1;
		}
		else if (i == 2)
		{
			// Ось X < 0
			pavil[3] = new Point3D();
            pavil[3][0] = -w4;
			pavil[3][1] = 0.0;
			pavil[3][2] = z4;

			pavil[7] = new Point3D();
			pavil[7][0] = -w3;
			pavil[7][1] = 0;
			pavil[7][2] = -s3[1];

			pavil[11] = new Point3D();
			pavil[11][0] = -w2;
			pavil[11][1] = 0;
			pavil[11][2] = -s2[1];

			pavil[15] = new Point3D();
            pavil[15][0] = -w1;
			pavil[15][1] = 0.0;
			pavil[15][2] = z1;
		}
		else
		{
			// Ось Y < 0
			pavil[2] = new Point3D();
            pavil[2][0] = 0.0;
			pavil[2][1] = -w4;
			pavil[2][2] = z4;

			pavil[6] = new Point3D();
			pavil[6][0] = 0;
			pavil[6][1] = -w3;
			pavil[6][2] = -s3[1];

			pavil[10] = new Point3D();
			pavil[10][0] = 0;
			pavil[10][1] = -w2;
			pavil[10][2] = -s2[1];

			pavil[14] = new Point3D();
            pavil[14][0] = 0.0;
			pavil[14][1] = -w1;
			pavil[14][2] = z1;
        }
    }
	pavil[16] = new Point3D();
    pavil[16][0] = 0.0;
    pavil[16][1] = 0.0;
    pavil[16][2] = -hp - r/2;
</pre>

<h3 align = "center"> Краткое резюме  </h3>
<p>
В данном разделе было рассмотрено создание огранка принцесса с рундистом подушка. Эта огранка не является
классической огранкой принцесса так как у нее рундист выполнен не в виде квадрата а в виде подушки и,
следовательно, форма короны также не является прямоуглльной. Классическими огранками принцесса являются
огранки показанные на рисунке <b>1</b>. Однако существуют огранки принцесса, которые имеют несколько иной вид короны и павильона. 
На рис.<b>9</b> показана огранка, у которой корона состоит из трех уровней, а павильон состоит из <b>44</b> граней.
А на рис.<b>10</b> представлен внешний вид модели огранки, корона которой совпадает с короной огранки показанной на рис.<b>9</b>, 
но павильон имеет чуть более сложную форму – у этой огранки он состоит из <b>52</b> граней. 
Процесс построения этих двух многогранников совершенно иной, чем у рассмотренной в этой главе огранки. 
</p>
<img src = "png_06.png" class="center-img">

<h3 align = "center">&emsp;&emsp;
<a href="../Trilliant/Chapter_29.html"> <span class=brown>Глава 29 </span></a>  <span class=brown>&ensp;◄</span>
&emsp;&emsp;&emsp;
<a href="../index.html"> <span class=brown> Содержание  </span></a>
&emsp;&emsp;&emsp;
 <span class=brown>► &ensp;</span><a href="../Pyramid/Summary.html"> <span class=brown> Заключение  </span></a>
</h3>

</body>
</html>
