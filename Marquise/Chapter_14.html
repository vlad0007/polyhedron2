<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Chapter 14 - Marquise girdle</title>
	<link rel="stylesheet" type="text/css" href="../libs/style.css">
	<script src="../libs/run_prettify.js?autoload=true&amp;lang=css" defer=""></script>
	<script type = "text/javascript" src = "../libs/dat.gui.js"></script>
	<script src="../libs/WebGeometry.js"></script>
	<script src="../libs/canvas2D.js"></script>
	<script src="marquise_girdle.js"></script>

	<style>
		div.out_girdle
		{
			position: relative;
			width: 900px;
			height: 600px;
			left: 5px;
			background-color: #ffffff;
			border: solid 2px;
		}
		
		div.gui_girdle
		{
			position: absolute;
			left: 0px;
			top: 505px;	
			height: 90px;
			width: 900px;
			background-color: #eeeeee;
			border: solid 1px;
		}
	</style>

</head>

<body>

<h3 align = "center">&emsp;&emsp;
<a href="https://vlad0007.github.io/polyhedron1/SuperMultifacet/Chapter_13.html"> <span class=brown>Глава 13 </span></a>  <span class=brown>&ensp;◄</span>
&emsp;&emsp;&emsp;
<a href="../index.html"> <span class=brown> Содержание  </span></a>
&emsp;&emsp;&emsp;
 <span class=brown>► &ensp;</span><a href="../Marquise/Chapter_15.html"> <span class=brown> Глава 15  </span></a>
</h3>

<h2 align = "center">Three.js и геометрия. &ensp; Глава 14. &ensp; Рундист огранки маркиз (<em>marquise</em>)</h2>
<p>
В качестве направляющей линии для цилиндра рундиста берутся или две пересекающиеся дуги окружности  
или две пересекающиеся дуги эллипса. Программа в работе показана ниже.
</p>

<div class="out_girdle" id="out_girdle_01">  
		<canvas id="canvas_01" width="900" height="500" style="border: 0px solid"></canvas>
		<div class="gui_girdle" id="gui_container1" ></div> 
</div>

<h3 align = "center"> Расчет и отрисовка на холсте формы рундиста</h3>
<p>
На рисунке <b>1</b> показан первый этап построения линии рундиста огранки. 
Окружность,  центр которой расположен в точке <b>A</b>, пересечена справа от ее центра осью <b>OY</b>. 
Точка пересечения <b>B</b> окружности с осью <b>OY</b> определяет положение острия рундиста. 
Обычно это острие называют носиком рундиста (и всей огранки в целом). 
Дуга окружности <b><em>BC</em></b> представляет собой лишь одну четвертую часть линии рундиста. 
Остальные три четверти линии рундиста, если найдена дуга <b><em>BC</em></b>, можно определить исходя из соображений симметрии.
Сначала рассмотрим вариант, когда линия рундиста строится на основе дуги окружности.
</p> 
<p>
Исходными данными для расчета центра окружности <b>A</b> и радиуса окружности, 
который на рисунке <b>1</b> представлен отрезком <b>AB</b>, является положение точек <b>B</b> и <b>C</b>. 
Будем считать, что относительная ширина огранки при проведении расчетов связанных с построением 
формы рундиста равна <b>2.0</b>. В дальнейшем мы приведем относительную ширину огранки к значению равному <b>1.0</b>,
которое ранее мы условились принимать за стандартную относительную ширину огранки (и рундиста). 
</p>
<p>
Расположим окружность с центром в точке <b>A</b> относительно оси <b>OY</b> таким образом, чтобы координаты 
точки <b>C</b> по оси <b>OX</b> стали равны половине ширины огранки, а по оси <b>OY</b> приняли нулевое значение.
В этом случае точка <b>B</b>, расположенная на острие рундиста, имеет координаты <b>(0.0, - u)</b>. 
При значении ширины огранки равной <b>2.0</b>, длина огранки равна значению <b>2.0 • lw</b>. 
Значение <b>u</b> можно найти исходя из величины удлинения огранки <b>lw</b> и принимая во внимание тот факт, 
что ширина огранки по оси <b>OX</b> (рисунок <b>1</b>) равна <b>2.0</b>. Из этого следует, что значение величины <b>u</b> 
оказывается равной величине удлинения огранки <b>lw</b>.
</p>
<p>
Еще раз, чтобы в дальнейшем не возникло недопонимание в связи со значением ширины огранки, уточним сказанное выше. 
В функции <code>InitGirdle</code> для огранки маркиз, также как и в одноименной функции <code>InitGirdle</code> 
из огранок пирамида и бриллиант, значение ширины огранки принимается равной <b>1.0</b>. 
Но для удобства расчета на предварительном этапе расчета мы принимаем, 
как это видно из рассмотрения рисунка <b>1</b>, в огранке маркиз значение ширины рундиста (и огранки), равное <b>2.0</b>.  
Поэтому, после того как расчет формы рундиста маркиза будет завершен, следует все значения координат 
вершин рундиста по осям <b>OX</b> и <b>OY</b> разделить на число <b>2.0</b> для приведения нормированной 
ширины огранки к значению <b>1.0</b>. Это будет иметь значение когда мы перейдем к созданию 
трехмерной модели на основе расчитанного рундиста огранки. 
</p>
<p>
Заметим еще, что для огранок пирамида и бриллиант удлинение огранки задавалось вдоль оси <b>OX</b>, 
а на рисунках <b>1</b> и <b>2</b>, а также в самой программе, удлинение задано вдоль оси <b>OY</b> 
(отрезок <b>OB</b> равен половине длины огранки). 
Для того чтобы и в огранке маркиз ширина измерялась вдоль оси <b>OY</b>, а длина вдоль оси <b>OX</b>, 
в дальнейшем (в <b>3D</b>-модели), при расстановке вершин на рундисте, мы развернем огранку таким образом, 
чтобы ее удлинение задавалось стандартным образом – вдоль оси <b>OX</b>. Те, кто пожелает более глубоко познакомиться 
с расчетом формы рундиста, могут прочитать приведенную далее врезку. Заметим, что для того, чтобы вид рундиста в 
программе стал подобным тому, который приведен на рисунке <b>2</b>, в программе следует значение параметра &delta; отрицательным. 
В тексте программы (и на рисунке <b>2</b>) для параметра <b>&delta;</b> используется переменная <code>vp</code>.
</p>
<img src = "Marquise_text.png" class="center-img-rounded" border = "2px" >

<h3 align = "center"> Разбиение рундиста на сегменты</h3>
<p>
Рассмотрим процесс разбиения рундиста на сегменты. Будем считать, что рундист состоит из <b>64</b> сегментов. 
Сделаем разбивку только для одного квадранта. Для остальных квадрантов координаты вершин рундиста можно 
определить исходя из соображений симметрии огранки. Самой простой способ выполнить эту задачу состоит в том, 
чтобы разделить дугу <b><em>BC</em></b> рундиста (рисунок <b>2</b>) на <b>16</b> равных частей. 
Подобным образом, мы поступали при расстановке вершин на рундисте бриллианта. 
</p>
<p>
Но можно поступим поступить иначе – деление провести в два этапа. На первом этапе можно разделить 
дугу <b><em>BC</em></b> на четыре сегмента. Деление  следует произвести таким образом, 
чтобы можно было задавать размеры каждого из четырех сегментов.
Для этого потребуется ввести допонителный параметр (или несколько параметров) в <b>СДМ</b>.
На втором этапе потребуется разделить каждый получившийся сегмент еще раз, 
но теперь уже (скорее всего) на четыре равные части. 
Такой способ разбивки рундиста на сегменты позволит изменять положение его узловых вершин. 
Это в свою очередь даст возможность изменять форму короны и павильона огранки, 
так как она во многом определяется положением вершин на рундисте. Однако для простоты мы ограничимся 
делением дуги  <b><em>BC</em></b> рундиста (рисунок <b>2</b>) на <b>16</b> равных частей.
</p>
<h3 align = "center"> Расчет координат вершин кривой рундиста огранки маркиз</h3>
<pre class="prettyprint" id="quine">
function init_girdle()
{
	// Принимаем ширину рундиста огранки равной 2.
	// Следовательно длина огранки равна lw*2.
	// Поэтому координата Y точки B равна lw.
	// Обозначим эту величину буквой u.
	u = lw;
	if ( u < 0 ) 
		return null;

	// Находим угол наклона касательной к окружности в точке B к оси OY
	// fi = asin(OB/AB) или
	// fi = asin(OB/AC) или 
	// fi = asin(u/(OA + 1)
	// Обозначим s = OA, тогда 
	// fi = asin(u/(s + 1)
	// Так как прямоугольник AOB прямоугольный, то s*s + u*u = (s+1)*(s+1)
	// следовательно s = (u*u - 1)/2 и поэтому:
	fi = Math.asin ( ( u + u ) / ( u * u + 1.0) );
	// Находим угол наклона касательной к эллипсу в точке B к оси OY
	psi = fi + vp;  // δ = vp
	// Находим координату X точки пересечения касательной к эллипсу с осью OX.
	t = u * Math.tan(psi);
	if ( t <= 2.0) 
		return null;
	// Находим величину полуоси эллипса по горизонтали
	a = ( t - 1.0 ) / ( t - 2.0 );
	// Так как ширину рундиста огранки приняли равной 2, то координата X 
	// точки C равна 1. Следовательно величина отрезка O - O1 равна q.
	q = a - 1.0;
	// Находим величину полуоси эллипса по вертикали
	b = u * ( t - 1.0 ) / Math.sqrt( t * t - ( t + t ) );
	
	//  При расчете формы рундиста и получении формул используемых
	// для этого расчета (полуоси эллипса a и b) использовалось свйство касательной к эллипсу.
	// Смотри, напрмер, Н.И.Мусхелишвили "Курс аналитической геометрии" изд.5 § 241.
	// В обозначениях используемых при выводе рундиста на экран это свойство 
	// записывается следующим образом:
	// O1 - координата центра ellipse_1
	// M - координата X пересечения прямой касательной к ellipse_1 в точке B
	// C - координата X пересечения линии ellipse_1 с осью OX
	// a - величина горизонтальной полуоси эллипса ellipse_1			
	/*
	var O = new Point2D(0,0);
	var C = new Point2D(1,0);
	var O1 = new Point2D(C[0] - a, 0);
	var M = new Point2D(t, 0);
	var d1 = O1.Distance(O);
	var d2 = O1.Distance(M);
	var a2 = a * a;  		
	var ratio = (a*a) / ( d1*d2); // ratio = 1 
	*/
	//********************************************************************
	//      Используя введенные ранее обозначения:
	// q * (t + q) = a * a    - Это и есть свойство касательной к эллипсу.
	// Подставив в последнее выражение значение для q = a – 1.0,
	// получим значение для полуоси эллипса a = (t-1)/(t-2).
	// Для расчета величины полуоси эллипса b следут провести вертикальную
	// прямую через центр эллипса O1 и зафиксировать 
	// точку пересечения V этой прямой с касательной к эллипсу.
	// Затем, из рассмотрения подобных треугольников BWV и MOB
	// можно записать пропорцию  p / u = q / t   где p - длина отрезка WV.
	// Отсюда p = u * q / t
	// Исходя из вышеприведенного свойства касательной к эллипсу в точке B
	// можно записать  u * (p + u) = b * b 
	// Теперь зная, как вычисляются величины a, p, u, q, t мы можем записать
	// после некоторых преобразований значение для полуоси b:
	//      b = u * ( t - 1.0 ) / Math.sqrt( t * t - ( t + t ) );
	//************************************************************************
	
	// Расчет сегментов на рундисте.
	gamma = Math.acos ( q / a ); 
	//gamma = Math.atan( u / (a-1) );  - неправильная расстановка вершин
	// В этой программе рундист делится на фиксированные части.
	var delta = gamma/16;

	var i = 0;
	var ang_currrent = 0.0;

	var x, y, w;
	for ( i = 0; i < 17; i++ )
	{
		x = Math.cos(ang_currrent);
		y = -Math.sin(ang_currrent);

		girdle[i] = new Point2D( a * x - q, b * y);
		ang_currrent = ang_currrent + delta;
	}
	
	for ( i = 1; i < 17; i++ )
	{
		girdle[i+16] = new Point2D(-girdle[16-i][0], girdle[16-i][1]);
	}
	
	for ( i = 1; i < 17; i++ )
	{
		girdle[i+32] = new Point2D(girdle[32-i][0], -girdle[32-i][1]);
	}

	for ( i = 1; i < 16; i++ )
	{
		girdle[i+48] = new Point2D(-girdle[48-i][0], girdle[48-i][1]);
	}
}
</pre>

<h3 align = "center">&emsp;&emsp;
<a href="https://vlad0007.github.io/polyhedron1/Supermultifacet/Chapter_13.html"> <span class=brown>Глава 13 </span></a>  <span class=brown>&ensp;◄</span>
&emsp;&emsp;&emsp;
<a href="../index.html"> <span class=brown> Содержание  </span></a>
&emsp;&emsp;&emsp;
 <span class=brown>► &ensp;</span><a href="../Marquise/Chapter_15.html"> <span class=brown> Глава 15  </span></a>
</h3>

</body>
</html>
